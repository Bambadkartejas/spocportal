<!doctype html>
<html>
<head>
<meta charset="utf-8" />
<title>Activity Details - SPOC Portal</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="p-4">
<div class="container">
<a href="/activities" class="btn btn-link">Back to Activities</a>
<h3 th:text="${activity.name}">Activity Name</h3>
<p>Date: <span th:text="${activity.activityDate}"></span> | CreatedBy: <span th:text="${activity.createdBy}"></span></p>


<div id="summary" class="mb-3"></div>


<table class="table table-bordered" id="assignTable">
<thead><tr><th>Group</th><th>SPOC</th><th>Email</th><th>Contact</th><th>Comments</th><th>Status</th><th>Action</th></tr></thead>
<tbody></tbody>
</table>
</div>


<script>
const activityId = location.pathname.split('/').pop();
async function loadAssignments(){
const res = await fetch('/api/activities/' + activityId + '/assignments');
const list = await res.json();
const tbody = document.querySelector('#assignTable tbody');
tbody.innerHTML = '';
let pending=0, confirmed=0, nack=0;
list.forEach(a => {
if(a.status==='Pending') pending++;
if(a.status==='Confirmed') confirmed++;
if(a.status==='NACK') nack++;
const tr = document.createElement('tr');
tr.innerHTML = `
<td>${a.spoc.teamName}</td>
<td>${a.spoc.spocName}</td>
<td>${a.spoc.email}</td>
<td>${a.spoc.contactNumber}</td>
<td><input class='form-control' id='c_${a.id}' value='${a.comments||''}' /></td>
<td>
<select id='s_${a.id}' class='form-select'>
<option ${a.status==='Pending'?'selected':''}>Pending</option>
<option ${a.status==='Confirmed'?'selected':''}>Confirmed</option>
<option ${a.status==='NACK'?'selected':''}>NACK</option>
</select>
</td>
<td><button class='btn btn-sm btn-primary' onclick='save(${a.id})'>Save</button></td>
`;
tbody.appendChild(tr);
});
document.getElementById('summary').innerHTML = `Pending: ${pending} &nbsp; Confirmed: ${confirmed} &nbsp; NACK: ${nack}`;
}
async function save(id){
const payload = { comments: document.getElementById('c_'+id).value, status: document.getElementById('s_'+id).value };
await fetch('/api/assignments/' + id, {method:'PUT', headers:{'Content-Type':'application/json'}, body: JSON.stringify(payload)});
loadAssignments();
}
window.onload = loadAssignments;
</script>
</body>
</html>